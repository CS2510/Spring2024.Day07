<!DOCTYPE html>
<html>

<head>
    <title>A Simple Game</title>
    <style>
        * {
            margin: 0;
            overflow: hidden;
        }
    </style>
</head>

<body>
    <canvas id="canv">
    </canvas>
    <script src="Time.js"></script>
    <script src="Scene.js"></script>
    <script>

        /** Place to store values that last across scenes */
        class Globals {
            static score = 0;
        }

        /** The main scene in our game */
        class MainScene extends Scene {
            constructor() {
                super()
                this.x = 0
                this.y = 0
            }
            update() {
                let speed = 100
                if (Input.keysDown.includes("ArrowLeft"))
                    this.x -= speed / Time.fps
                if (Input.keysDown.includes("ArrowRight"))
                    this.x += speed / Time.fps
                if (Input.keysDown.includes("ArrowUp"))
                    this.y -= speed / Time.fps
                if (Input.keysDown.includes("ArrowDown"))
                    this.y += speed / Time.fps
                Globals.score++

                if (this.x < 0) {
                    currentScene = new DeadScene()
                }
            }
            draw(ctx) {
                //Clear the canvas
                ctx.fillStyle = "lightgray"
                ctx.beginPath()
                ctx.rect(0, 0, ctx.canvas.width, ctx.canvas.height)
                ctx.fill()

                //Draw the circle with a green interior
                //and purple outline
                ctx.beginPath();
                ctx.fillStyle = "green"
                ctx.strokeStyle = "purple"
                ctx.lineWidth = 5
                ctx.arc(50 + this.x, 50 + this.y, 50, 0, Math.PI * 2)
                ctx.fill()
                ctx.stroke()

                ctx.fillStyle = "white"
                ctx.font = "30px Times"
                ctx.fillText(Globals.score, 0, 30)
            }
            drawUI(ctx) {
                ctx.fillStyle = "cyan"
                ctx.fillRect(100, 100, 100, 50);
            }
        }

        /** The final scene in our game */
        class DeadScene extends Scene {
            constructor() {
                super()
                this.timeSinceDeath = 0
            }
            update() {
                this.timeSinceDeath += Time.ms
                if (this.timeSinceDeath > 2000) {
                    Globals.score = 0
                    currentScene = new MainScene()
                }
            }
            drawUI(ctx) {

            }
            draw(ctx) {
                ctx.fillStyle = "black"
                ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height)

                ctx.fillStyle = "red"
                ctx.font = "30px Comic Sans MS"
                ctx.fillText("You Died", 30, 60)


                ctx.fillStyle = "white"
                ctx.font = "30px Times"
                ctx.fillText(Globals.score, 0, 30)
            }

        }

        let mainScene = new MainScene();
        let deadScene = new DeadScene();

        let currentScene = mainScene;

        class Input {
            /** Store input states for our game */
            static keysDown = []
            static mousePosition = { x: 0, y: 0 }

            /** Respond to mouse move events */
            static mousemove(e) {
                Input.mousePosition.x = e.clientX;
                Input.mousePosition.y = e.clientY;
            }

            /** Respond to key up events */
            static keyup(e) {
                let index = Input.keysDown.indexOf(e.code)
                Input.keysDown.splice(index, 1)
            }

            /** Respond to key down events */
            static keydown(e) {
                if (!Input.keysDown.includes(e.code))
                    Input.keysDown.push(e.code)
            }
        }

        /**
         * The game loop.
         * The game loop calls update and draw using a timer
         */
        function gameLoop() {
            let canvas = document.querySelector("#canv")
            let ctx = canvas.getContext("2d")

            //Make the canvas the same size as our window
            //so it is "full screen"
            canvas.width = window.innerWidth
            canvas.height = window.innerHeight

            // Update the current scene
            currentScene.update()

            //Draw in world space
            currentScene.draw(ctx)

            //Draw in Screen/UI space
            currentScene.drawUI(ctx)
        }

        /** Setup the game **/
        function setup() {
            document.addEventListener("keydown", Input.keydown)
            document.addEventListener("keyup", Input.keyup)

            document.addEventListener("mousemove", Input.mousemove)


            //In the background, create a thread and call
            //gameLoop every 100ms.

            setInterval(gameLoop, Time.ms)
        }

        setup()

    </script>
</body>

</html>